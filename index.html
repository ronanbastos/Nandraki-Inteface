<html><head><base href="https://websim.example.com/">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BlockCode: Sistema de Programação em Blocos com Funções Nandraki</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/blockly/9.3.1/blockly.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/blockly/9.3.1/blocks.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/blockly/9.3.1/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/htmlmixed/htmlmixed.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/xml/xml.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/css/css.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
<style>
  body {
    font-family: Arial, sans-serif;
    display: flex;
    flex-direction: column;
    height: 100vh;
    margin: 0;
    padding: 0;
    background-color: #f0f0f0;
  }
  #engineLink {
    background-color: #f8f8f8;
    padding: 10px;
    text-align: center;
    border-bottom: 1px solid #ddd;
  }
  #engineLink a {
    color: #4CAF50;
    text-decoration: none;
    font-weight: bold;
    margin: 0 10px;
  }
  #engineLink a:hover {
    text-decoration: underline;
  }
  #engineLink input {
    margin-top: 10px;
    width: 80%;
    padding: 5px;
    border: 1px solid #ddd;
    border-radius: 3px;
  }
  #blocklyDiv {
    flex-grow: 1;
    width: 100%;
    height: calc(60vh - 40px);
  }
  #bottomPanel {
    height: 40vh;
    display: flex;
    border-top: 2px solid #ddd;
  }
  #outputDiv, #codeDiv {
    width: 50%;
    height: 100%;
    background-color: #fff;
    padding: 10px;
    box-sizing: border-box;
    overflow-y: auto;
  }
  #outputDiv {
    border-right: 1px solid #ddd;
  }
  #buttonContainer {
    position: fixed;
    bottom: 20px;
    right: 20px;
    display: flex;
    gap: 10px;
    z-index: 1000;
  }
  #runButton, #copyButton, #openModalButton {
    padding: 10px 20px;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    transition: background-color 0.3s;
  }
  #runButton {
    background-color: #4CAF50;
  }
  #copyButton {
    background-color: #008CBA;
  }
  #openModalButton {
    background-color: #e91e63;
  }
  #runButton:hover {
    background-color: #45a049;
  }
  #copyButton:hover {
    background-color: #007B9A;
  }
  #openModalButton:hover {
    background-color: #d81b60;
  }
  #languageSelector {
    position: fixed;
    top: 10px;
    right: 10px;
    z-index: 1000;
  }
  #languageSelect {
    padding: 5px;
    border-radius: 3px;
    border: 1px solid #ddd;
    background-color: #fff;
    font-size: 14px;
  }
  .CodeMirror {
    height: 400px;
    border: 1px solid #ddd;
    font-family: monospace;
    font-size: 14px;
    line-height: 1.6;
    margin-bottom: 10px;
  }
  .modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.4);
  }
  .modal-content {
    background-color: #f8f8f8;
    margin: 5% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
    max-width: 800px;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }
  .modal h2 {
    margin-top: 0;
    color: #333;
  }
  #runGameButton {
    background-color: #4CAF50;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 16px;
    margin-top: 10px;
  }
  #runGameButton:hover {
    background-color: #45a049;
  }
  .close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
  }
  .close:hover,
  .close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
  }
</style>
</head>
<body>
  <div id="engineLink">
    <a href="https://github.com/ronanbastos/Nandraki.js/blob/main/nandraki.js" target="_blank">Nandraki.js Game Engine</a>
    | 
    <a href="https://ronanbastos.github.io/Documentation-Nandraki.js/" target="_blank">Documentação</a>
    <br>
    <input type="text" id="engineLinkInput" placeholder="Digite o link da engine" value="https://unpkg.com/nandraki@2.5.8/nandraki.js">
  </div>
  <div id="blocklyDiv"></div>
  <div id="bottomPanel">
    <div id="outputDiv"></div>
    <div id="codeDiv"></div>
  </div>
  <div id="buttonContainer">
    <button id="runButton">Executar</button>
    <button id="copyButton">Copiar Código</button>
    <button id="openModalButton">Abrir Modal</button>
  </div>
  <div id="languageSelector">
    <select id="languageSelect">
      <option value="pt">Português</option>
      <option value="en">English</option>
      <option value="es">Español</option>
    </select>
  </div>

  <div id="gameModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Estrutura do Jogo</h2>
      <div id="gameCodeEditor"></div>
      <button id="runGameButton">Executar Jogo</button>
    </div>
  </div>

  <xml id="toolbox" style="display: none">
    <category name="Nandraki" colour="#FF6B6B">
      <block type="game_print"></block>
      <block type="create_sprite"></block>
      <block type="create_obj"></block>
      <block type="create_ui"></block>
      <block type="game_coord"></block>
      <block type="game_colidir"></block>
      <block type="game_canvas_start"></block>
      <block type="game_canvas_text"></block>
      <block type="game_canvas_arc"></block>
      <block type="game_click"></block>
      <block type="game_spawn_sprite"></block>
      <block type="game_start_sound"></block>
      <block type="game_bd_load"></block>
      <block type="game_bd_remove"></block>
      <block type="game_bd_clear"></block>
      <block type="game_bd_save"></block>
      <block type="game_move_touch"></block>
      <block type="console_log"></block>
      <block type="print"></block>
      <block type="alert"></block>
      <block type="join_strings"></block>
      <block type="compare_variables"></block>
      <block type="string_length"></block>
      <block type="int_to_string"></block>
      <block type="let_variable"></block>
      <block type="const_variable"></block>
      <block type="global_var_variable"></block>
      <block type="game_display"></block>
    </category>
    <category name="Lógica" colour="#5C81A6">
      <block type="controls_if"></block>
      <block type="logic_compare"></block>
      <block type="logic_operation"></block>
      <block type="logic_negate"></block>
    </category>
    <category name="Loops" colour="#5C81A6">
      <block type="controls_repeat_ext">
        <value name="TIMES">
          <shadow type="math_number">
            <field name="NUM">10</field>
          </shadow>
        </value>
      </block>
      <block type="controls_whileUntil"></block>
      <block type="controls_for">
        <value name="FROM">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
        <value name="TO">
          <shadow type="math_number">
            <field name="NUM">10</field>
          </shadow>
        </value>
        <value name="BY">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
      </block>
    </category>
    <category name="Matemática" colour="#5C68A6">
      <block type="math_number"></block>
      <block type="math_arithmetic">
        <value name="A">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
        <value name="B">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
      </block>
      <block type="math_single">
        <value name="NUM">
          <shadow type="math_number">
            <field name="NUM">9</field>
          </shadow>
        </value>
      </block>
    </category>
    <category name="Texto" colour="#5CA68D">
      <block type="text"></block>
      <block type="text_join"></block>
      <block type="console_log"></block>
      <block type="print"></block>
      <block type="alert"></block>
      <block type="join_strings"></block>
      <block type="compare_variables"></block>
      <block type="string_length"></block>
      <block type="int_to_string"></block>
    </category>
    <category name="Variáveis" colour="#A65C81">
      <block type="variables_set"></block>
      <block type="variables_get"></block>
      <block type="let_variable"></block>
      <block type="const_variable"></block>
      <block type="global_var_variable"></block>
    </category>
    <category name="Funções" colour="#9A5CA6" custom="PROCEDURE"></category>
  </xml>

  <script>
    Blockly.Blocks['game_print'] = {
      init: function() {
        this.appendDummyInput()
            .appendField("Print Message");
        this.appendValueInput("MESSAGE")
            .setCheck("String")
            .appendField("Message");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour(230);
        this.setTooltip("Print a message using game.print()");
        this.setHelpUrl("");
      }
    };

    Blockly.JavaScript['game_print'] = function(block) {
      var message = Blockly.JavaScript.valueToCode(block, 'MESSAGE', Blockly.JavaScript.ORDER_ATOMIC) || '""';
      return `game.print(${message});\n`;
    };

    Blockly.Blocks['game_coord'] = {
      init: function() {
        this.appendDummyInput()
            .appendField("Get Coordinates of");
        this.appendValueInput("ID")
            .setCheck("String")
            .appendField("Object ID");
        this.setOutput(true, "Array");
        this.setColour(230);
        this.setTooltip("Get the coordinates [x,y] of an object by its ID");
        this.setHelpUrl("");
      }
    };

    Blockly.JavaScript['game_coord'] = function(block) {
      var id = Blockly.JavaScript.valueToCode(block, 'ID', Blockly.JavaScript.ORDER_ATOMIC) || '""';
      var code = `game.coord(${id})`;
      return [code, Blockly.JavaScript.ORDER_FUNCTION_CALL];
    };

    Blockly.Blocks['create_sprite'] = {
      init: function() {
        this.appendDummyInput()
            .appendField("Create Sprite");
        this.appendValueInput("ID")
            .setCheck("String")
            .appendField("ID");
        this.appendValueInput("LAYER")
            .setCheck("Number")
            .appendField("Layer");
        this.appendValueInput("IMAGE")
            .setCheck("String")
            .appendField("Image Path");
        this.appendValueInput("WIDTH")
            .setCheck("Number")
            .appendField("Width");
        this.appendValueInput("HEIGHT")
            .setCheck("Number")
            .appendField("Height");
        this.appendValueInput("FRAMES")
            .setCheck("Number")
            .appendField("Frames");
        this.appendValueInput("SPEED")
            .setCheck("Number")
            .appendField("Speed");
        this.appendValueInput("TOP")
            .setCheck("Number")
            .appendField("Top");
        this.appendValueInput("LEFT")
            .setCheck("Number")
            .appendField("Left");
        this.setInputsInline(false);
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour(230);
        this.setTooltip("Create a sprite with Nandraki");
      }
    };

    Blockly.Blocks['create_obj'] = {
      init: function() {
        this.appendDummyInput()
            .appendField("Create Object");
        this.appendValueInput("ID")
            .setCheck("String")
            .appendField("ID");
        this.appendValueInput("WIDTH")
            .setCheck("Number")
            .appendField("Width");
        this.appendValueInput("HEIGHT")
            .setCheck("Number")
            .appendField("Height");
        this.appendValueInput("TOP")
            .setCheck("Number")
            .appendField("Top");
        this.appendValueInput("LEFT")
            .setCheck("Number")
            .appendField("Left");
        this.appendValueInput("DEBUG")
            .setCheck("Boolean")
            .appendField("Debug");
        this.setInputsInline(false);
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour(230);
        this.setTooltip("Create an object with Nandraki");
      }
    };

    Blockly.Blocks['create_ui'] = {
      init: function() {
        this.appendDummyInput()
            .appendField("Create UI");
        this.appendValueInput("ID")
            .setCheck("String")
            .appendField("ID");
        this.appendValueInput("TEXT")
            .setCheck("String")
            .appendField("Text");
        this.appendValueInput("WIDTH")
            .setCheck("Number")
            .appendField("Width");
        this.appendValueInput("HEIGHT")
            .setCheck("Number")
            .appendField("Height");
        this.appendValueInput("TOP")
            .setCheck("Number")
            .appendField("Top");
        this.appendValueInput("LEFT")
            .setCheck("Number")
            .appendField("Left");
        this.setInputsInline(false);
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour(230);
        this.setTooltip("Create a UI element with Nandraki");
      }
    };

    Blockly.JavaScript['create_sprite'] = function(block) {
      const id = Blockly.JavaScript.valueToCode(block, 'ID', Blockly.JavaScript.ORDER_ATOMIC) || '""';
      const layer = Blockly.JavaScript.valueToCode(block, 'LAYER', Blockly.JavaScript.ORDER_ATOMIC) || '1';
      const image = Blockly.JavaScript.valueToCode(block, 'IMAGE', Blockly.JavaScript.ORDER_ATOMIC) || '""';
      const width = Blockly.JavaScript.valueToCode(block, 'WIDTH', Blockly.JavaScript.ORDER_ATOMIC) || '64';
      const height = Blockly.JavaScript.valueToCode(block, 'HEIGHT', Blockly.JavaScript.ORDER_ATOMIC) || '64';
      const frames = Blockly.JavaScript.valueToCode(block, 'FRAMES', Blockly.JavaScript.ORDER_ATOMIC) || '1';
      const speed = Blockly.JavaScript.valueToCode(block, 'SPEED', Blockly.JavaScript.ORDER_ATOMIC) || '1';
      const top = Blockly.JavaScript.valueToCode(block, 'TOP', Blockly.JavaScript.ORDER_ATOMIC) || '0';
      const left = Blockly.JavaScript.valueToCode(block, 'LEFT', Blockly.JavaScript.ORDER_ATOMIC) || '0';

      return `Nandraki.create_sprite(${id}, ${layer}, ${image}, null, null, null, null, ${width}, ${height}, ${frames}, ${speed}, ${top}, ${left});\n`;
    };

    Blockly.JavaScript['create_obj'] = function(block) {
      const id = Blockly.JavaScript.valueToCode(block, 'ID', Blockly.JavaScript.ORDER_ATOMIC) || '""';
      const width = Blockly.JavaScript.valueToCode(block, 'WIDTH', Blockly.JavaScript.ORDER_ATOMIC) || '0';
      const height = Blockly.JavaScript.valueToCode(block, 'HEIGHT', Blockly.JavaScript.ORDER_ATOMIC) || '0';
      const top = Blockly.JavaScript.valueToCode(block, 'TOP', Blockly.JavaScript.ORDER_ATOMIC) || '0';
      const left = Blockly.JavaScript.valueToCode(block, 'LEFT', Blockly.JavaScript.ORDER_ATOMIC) || '0';
      const debug = Blockly.JavaScript.valueToCode(block, 'DEBUG', Blockly.JavaScript.ORDER_ATOMIC) || 'false';

      return `Nandraki.create_obj(${id}, ${width}, ${height}, ${top}, ${left}, ${debug});\n`;
    };

    Blockly.JavaScript['create_ui'] = function(block) {
      const id = Blockly.JavaScript.valueToCode(block, 'ID', Blockly.JavaScript.ORDER_ATOMIC) || '""';
      const text = Blockly.JavaScript.valueToCode(block, 'TEXT', Blockly.JavaScript.ORDER_ATOMIC) || '""';
      const width = Blockly.JavaScript.valueToCode(block, 'WIDTH', Blockly.JavaScript.ORDER_ATOMIC) || '0';
      const height = Blockly.JavaScript.valueToCode(block, 'HEIGHT', Blockly.JavaScript.ORDER_ATOMIC) || '0';
      const top = Blockly.JavaScript.valueToCode(block, 'TOP', Blockly.JavaScript.ORDER_ATOMIC) || '0';
      const left = Blockly.JavaScript.valueToCode(block, 'LEFT', Blockly.JavaScript.ORDER_ATOMIC) || '0';

      return `Nandraki.create_ui(${id}, ${text}, ${width}, ${height}, ${top}, ${left});\n`;
    };

    Blockly.Blocks['game_colidir'] = {
      init: function() {
        this.appendDummyInput()
            .appendField("Check Collision between");
        this.appendValueInput("ID1")
            .setCheck("String")
            .appendField("Object 1 ID");
        this.appendValueInput("ID2")
            .setCheck("String")
            .appendField("Object 2 ID");
        this.setOutput(true, "Boolean");
        this.setColour(230);
        this.setTooltip("Check if two objects are colliding");
        this.setHelpUrl("");
      }
    };

    Blockly.JavaScript['game_colidir'] = function(block) {
      var id1 = Blockly.JavaScript.valueToCode(block, 'ID1', Blockly.JavaScript.ORDER_ATOMIC) || '""';
      var id2 = Blockly.JavaScript.valueToCode(block, 'ID2', Blockly.JavaScript.ORDER_ATOMIC) || '""';
      var code = `game.colidir(${id1}, ${id2})`;
      return [code, Blockly.JavaScript.ORDER_FUNCTION_CALL];
    };

    Blockly.Blocks['game_move_touch'] = {
      init: function() {
        this.appendDummyInput()
            .appendField("Move by Touch");
        this.appendValueInput("ID")
            .setCheck("String")
            .appendField("Object ID");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour(230);
        this.setTooltip("Move an object by touch/mouse input");
        this.setHelpUrl("");
      }
    };

    Blockly.JavaScript['game_move_touch'] = function(block) {
      var id = Blockly.JavaScript.valueToCode(block, 'ID', Blockly.JavaScript.ORDER_ATOMIC) || '""';
      return `game.move_touch(${id});\n`;
    };

    Blockly.Blocks['game_canvas_start'] = {
      init: function() {
        this.appendDummyInput()
            .appendField("Create Canvas");
        this.appendValueInput("ID")
            .setCheck("String")
            .appendField("ID");
        this.appendValueInput("WIDTH")
            .setCheck("Number")
            .appendField("Width");
        this.appendValueInput("HEIGHT")
            .setCheck("Number")
            .appendField("Height");
        this.setInputsInline(false);
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour(230);
        this.setTooltip("Create a canvas with specified dimensions");
        this.setHelpUrl("");
      }
    };

    Blockly.JavaScript['game_canvas_start'] = function(block) {
      var id = Blockly.JavaScript.valueToCode(block, 'ID', Blockly.JavaScript.ORDER_ATOMIC) || '""';
      var width = Blockly.JavaScript.valueToCode(block, 'WIDTH', Blockly.JavaScript.ORDER_ATOMIC) || '800';
      var height = Blockly.JavaScript.valueToCode(block, 'HEIGHT', Blockly.JavaScript.ORDER_ATOMIC) || '600';
      
      return `game.canvas_start(${id}, ${width}, ${height});\n`;
    };

    Blockly.Blocks['game_canvas_text'] = {
      init: function() {
        this.appendDummyInput()
            .appendField("Draw Canvas Text");
        this.appendValueInput("TEXT")
            .setCheck("String")
            .appendField("Text");
        this.appendValueInput("FONT")
            .setCheck("String")
            .appendField("Font");
        this.appendValueInput("COLOR")
            .setCheck("String")
            .appendField("Color");
        this.appendValueInput("X")
            .setCheck("Number")
            .appendField("X Position");
        this.appendValueInput("Y")
            .setCheck("Number")
            .appendField("Y Position");
        this.setInputsInline(false);
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour(230);
        this.setTooltip("Draw text on the canvas with specified properties");
        this.setHelpUrl("");
      }
    };

    Blockly.JavaScript['game_canvas_text'] = function(block) {
      var text = Blockly.JavaScript.valueToCode(block, 'TEXT', Blockly.JavaScript.ORDER_ATOMIC) || '""';
      var font = Blockly.JavaScript.valueToCode(block, 'FONT', Blockly.JavaScript.ORDER_ATOMIC) || '"12px Arial"';
      var color = Blockly.JavaScript.valueToCode(block, 'COLOR', Blockly.JavaScript.ORDER_ATOMIC) || '"black"';
      var x = Blockly.JavaScript.valueToCode(block, 'X', Blockly.JavaScript.ORDER_ATOMIC) || '0';
      var y = Blockly.JavaScript.valueToCode(block, 'Y', Blockly.JavaScript.ORDER_ATOMIC) || '0';
      
      return `game.canvas_text(${text}, ${font}, ${color}, ${x}, ${y});\n`;
    };

    Blockly.Blocks['game_canvas_arc'] = {
      init: function() {
        this.appendDummyInput()
            .appendField("Draw Canvas Arc");
        this.appendValueInput("X")
            .setCheck("Number")
            .appendField("X Position");
        this.appendValueInput("Y")
            .setCheck("Number")
            .appendField("Y Position"); 
        this.appendValueInput("FONT")
            .setCheck("Number")
            .appendField("Font/Size");
        this.appendValueInput("B")
            .setCheck("Number")
            .appendField("Begin Angle");
        this.appendValueInput("P")
            .setCheck("Number")
            .appendField("End Angle");
        this.setInputsInline(false);
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour(230);
        this.setTooltip("Draw an arc on the canvas");
        this.setHelpUrl("");
      }
    };

    Blockly.JavaScript['game_canvas_arc'] = function(block) {
      var x = Blockly.JavaScript.valueToCode(block, 'X', Blockly.JavaScript.ORDER_ATOMIC) || '0';
      var y = Blockly.JavaScript.valueToCode(block, 'Y', Blockly.JavaScript.ORDER_ATOMIC) || '0';
      var font = Blockly.JavaScript.valueToCode(block, 'FONT', Blockly.JavaScript.ORDER_ATOMIC) || '0';
      var b = Blockly.JavaScript.valueToCode(block, 'B', Blockly.JavaScript.ORDER_ATOMIC) || '0';
      var p = Blockly.JavaScript.valueToCode(block, 'P', Blockly.JavaScript.ORDER_ATOMIC) || '0';
      
      return `game.canvas_arc(${x}, ${y}, ${font}, ${b}, ${p});\n`;
    };

    Blockly.Blocks['game_click'] = {
      init: function() {
        this.appendDummyInput()
            .appendField("On Click");
        this.appendValueInput("ID")
            .setCheck("String")
            .appendField("Object ID");
        this.appendStatementInput("FUNC")
            .setCheck(null)
            .appendField("Do");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour(230);
        this.setTooltip("Execute code when object is clicked");
        this.setHelpUrl("");
      }
    };

    Blockly.JavaScript['game_click'] = function(block) {
      var id = Blockly.JavaScript.valueToCode(block, 'ID', Blockly.JavaScript.ORDER_ATOMIC) || '""';
      var func = Blockly.JavaScript.statementToCode(block, 'FUNC') || '';
      var code = `game.click(${id}, function() {\n${func}});\n`;
      return code;
    };

    Blockly.Blocks['game_spawn_sprite'] = {
      init: function() {
        this.appendDummyInput()
            .appendField("Spawn Sprite");
        this.appendValueInput("ID")
            .setCheck("String")
            .appendField("ID");
        this.appendValueInput("IMAGE")
            .setCheck("String")
            .appendField("Image Path");
        this.appendValueInput("LEFT")
            .setCheck("Number")
            .appendField("Left Position");
        this.appendValueInput("TOP")
            .setCheck("Number")
            .appendField("Top Position");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour(230);
        this.setTooltip("Spawn a sprite at specified position");
        this.setHelpUrl("");
      }
    };

    Blockly.JavaScript['game_spawn_sprite'] = function(block) {
      var id = Blockly.JavaScript.valueToCode(block, 'ID', Blockly.JavaScript.ORDER_ATOMIC) || '""';
      var image = Blockly.JavaScript.valueToCode(block, 'IMAGE', Blockly.JavaScript.ORDER_ATOMIC) || '""';
      var left = Blockly.JavaScript.valueToCode(block, 'LEFT', Blockly.JavaScript.ORDER_ATOMIC) || '0';
      var top = Blockly.JavaScript.valueToCode(block, 'TOP', Blockly.JavaScript.ORDER_ATOMIC) || '0';
      
      return `game.spawn_sprite(${id}, ${image}, ${left}, ${top});\n`;
    };

    Blockly.Blocks['game_start_sound'] = {
      init: function() {
        this.appendDummyInput()
            .appendField("Start Sound");
        this.appendValueInput("SOUND_SRC")
            .setCheck("String")
            .appendField("Sound Source");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour(230);
        this.setTooltip("Start playing a sound from the specified source");
        this.setHelpUrl("");
      }
    };

    Blockly.JavaScript['game_start_sound'] = function(block) {
      var soundSrc = Blockly.JavaScript.valueToCode(block, 'SOUND_SRC', Blockly.JavaScript.ORDER_ATOMIC) || '""';
      return `game.start_som(${soundSrc});\n`;
    };

    Blockly.Blocks['game_bd_load'] = {
      init: function() {
        this.appendValueInput("VALUE")
            .setCheck("String")
            .appendField("Load from Database");
        this.setOutput(true, null);
        this.setColour(230);
        this.setTooltip("Load a value from the database");
        this.setHelpUrl("");
      }
    };

    Blockly.Blocks['game_bd_remove'] = {
      init: function() {
        this.appendValueInput("VALUE")
            .setCheck("String")
            .appendField("Remove from Database");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour(230);
        this.setTooltip("Remove a value from the database");
        this.setHelpUrl("");
      }
    };

    Blockly.Blocks['game_bd_clear'] = {
      init: function() {
        this.appendDummyInput()
            .appendField("Clear Database");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour(230);
        this.setTooltip("Clear all data from the database");
        this.setHelpUrl("");
      }
    };

    Blockly.Blocks['game_bd_save'] = {
      init: function() {
        this.appendValueInput("KEY")
            .setCheck("String")
            .appendField("Save to Database Key");
        this.appendValueInput("VALUE")
            .setCheck(null)
            .appendField("Value");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour(230);
        this.setTooltip("Save a key-value pair to the database");
        this.setHelpUrl("");
      }
    };

    Blockly.JavaScript['game_bd_load'] = function(block) {
      var value = Blockly.JavaScript.valueToCode(block, 'VALUE', Blockly.JavaScript.ORDER_ATOMIC) || '""';
      var code = `game.bd_load(${value})`;
      return [code, Blockly.JavaScript.ORDER_FUNCTION_CALL];
    };

    Blockly.JavaScript['game_bd_remove'] = function(block) {
      var value = Blockly.JavaScript.valueToCode(block, 'VALUE', Blockly.JavaScript.ORDER_ATOMIC) || '""';
      return `game.bd_remove(${value});\n`;
    };

    Blockly.JavaScript['game_bd_clear'] = function(block) {
      return 'game.bd_clear();\n';
    };

    Blockly.JavaScript['game_bd_save'] = function(block) {
      var key = Blockly.JavaScript.valueToCode(block, 'KEY', Blockly.JavaScript.ORDER_ATOMIC) || '""';
      var value = Blockly.JavaScript.valueToCode(block, 'VALUE', Blockly.JavaScript.ORDER_ATOMIC) || '""';
      return `game.bd_save(${key}, ${value});\n`;
    };

    Blockly.Blocks['console_log'] = {
      init: function() {
        this.appendValueInput("TEXT")
            .setCheck(null)
            .appendField("console.log");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour(160);
        this.setTooltip("Log a message to the console");
        this.setHelpUrl("");
      }
    };

    Blockly.JavaScript['console_log'] = function(block) {
      var text = Blockly.JavaScript.valueToCode(block, 'TEXT', Blockly.JavaScript.ORDER_ATOMIC) || '""';
      return 'console.log(' + text + ');\n';
    };

    Blockly.Blocks['print'] = {
      init: function() {
        this.appendValueInput("TEXT")
            .setCheck(null)
            .appendField("print");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour(160);
        this.setTooltip("Print a message");
        this.setHelpUrl("");
      }
    };

    Blockly.JavaScript['print'] = function(block) {
      var text = Blockly.JavaScript.valueToCode(block, 'TEXT', Blockly.JavaScript.ORDER_ATOMIC) || '""';
      return 'console.log(' + text + ');\n';
    };

    Blockly.Blocks['alert'] = {
      init: function() {
        this.appendValueInput("TEXT")
            .setCheck(null)
            .appendField("alert");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour(160);
        this.setTooltip("Show an alert message");
        this.setHelpUrl("");
      }
    };

    Blockly.JavaScript['alert'] = function(block) {
      var text = Blockly.JavaScript.valueToCode(block, 'TEXT', Blockly.JavaScript.ORDER_ATOMIC) || '""';
      return 'alert(' + text + ');\n';
    };

    Blockly.Blocks['join_strings'] = {
      init: function() {
        this.appendValueInput("STRING1")
            .setCheck("String")
            .appendField("join");
        this.appendValueInput("STRING2")
            .setCheck("String")
            .appendField("and");
        this.setOutput(true, "String");
        this.setColour(160);
        this.setTooltip("Join two strings together");
        this.setHelpUrl("");
      }
    };

    Blockly.JavaScript['join_strings'] = function(block) {
      var string1 = Blockly.JavaScript.valueToCode(block, 'STRING1', Blockly.JavaScript.ORDER_ATOMIC) || '""';
      var string2 = Blockly.JavaScript.valueToCode(block, 'STRING2', Blockly.JavaScript.ORDER_ATOMIC) || '""';
      return [string1 + ' + ' + string2, Blockly.JavaScript.ORDER_ADDITION];
    };

    Blockly.Blocks['compare_variables'] = {
      init: function() {
        this.appendValueInput("VAR1")
            .setCheck(null)
            .appendField("compare");
        this.appendValueInput("VAR2")
            .setCheck(null)
            .appendField("with");
        this.setOutput(true, "Boolean");
        this.setColour(160);
        this.setTooltip("Compare two variables");
        this.setHelpUrl("");
      }
    };

    Blockly.JavaScript['compare_variables'] = function(block) {
      var var1 = Blockly.JavaScript.valueToCode(block, 'VAR1', Blockly.JavaScript.ORDER_ATOMIC) || '0';
      var var2 = Blockly.JavaScript.valueToCode(block, 'VAR2', Blockly.JavaScript.ORDER_ATOMIC) || '0';
      return [var1 + ' === ' + var2, Blockly.JavaScript.ORDER_EQUALITY];
    };

    Blockly.Blocks['string_length'] = {
      init: function() {
        this.appendValueInput("STRING")
            .setCheck("String")
            .appendField("length of");
        this.setOutput(true, "Number");
        this.setColour(160);
        this.setTooltip("Get the length of a string");
        this.setHelpUrl("");
      }
    };

    Blockly.JavaScript['string_length'] = function(block) {
      var string = Blockly.JavaScript.valueToCode(block, 'STRING', Blockly.JavaScript.ORDER_ATOMIC) || '""';
      return [string + '.length', Blockly.JavaScript.ORDER_MEMBER];
    };

    Blockly.Blocks['int_to_string'] = {
      init: function() {
        this.appendValueInput("NUMBER")
            .setCheck("Number")
            .appendField("convert number");
        this.appendDummyInput()
            .appendField("to text");
        this.setOutput(true, "String");
        this.setColour(160);
        this.setTooltip("Convert a number to text");
        this.setHelpUrl("");
      }
    };

    Blockly.JavaScript['int_to_string'] = function(block) {
      var number = Blockly.JavaScript.valueToCode(block, 'NUMBER', Blockly.JavaScript.ORDER_ATOMIC) || '0';
      return ['String(' + number + ')', Blockly.JavaScript.ORDER_FUNCTION_CALL];
    };

    Blockly.Blocks['let_variable'] = {
      init: function() {
        this.appendDummyInput()
            .appendField("let")
            .appendField(new Blockly.FieldTextInput("variableName"), "VAR");
        this.appendValueInput("VALUE")
            .setCheck(null)
            .appendField("=");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour(330);
        this.setTooltip("Declare a let variable");
        this.setHelpUrl("");
      }
    };

    Blockly.JavaScript['let_variable'] = function(block) {
      var varName = block.getFieldValue('VAR');
      var value = Blockly.JavaScript.valueToCode(block, 'VALUE', Blockly.JavaScript.ORDER_ASSIGNMENT) || '0';
      return 'let ' + varName + ' = ' + value + ';\n';
    };

    Blockly.Blocks['const_variable'] = {
      init: function() {
        this.appendDummyInput()
            .appendField("const")
            .appendField(new Blockly.FieldTextInput("constantName"), "VAR");
        this.appendValueInput("VALUE")
            .setCheck(null)
            .appendField("=");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour(330);
        this.setTooltip("Declare a constant");
        this.setHelpUrl("");
      }
    };

    Blockly.JavaScript['const_variable'] = function(block) {
      var varName = block.getFieldValue('VAR');
      var value = Blockly.JavaScript.valueToCode(block, 'VALUE', Blockly.JavaScript.ORDER_ASSIGNMENT) || '0';
      return 'const ' + varName + ' = ' + value + ';\n';
    };

    Blockly.Blocks['global_var_variable'] = {
      init: function() {
        this.appendDummyInput()
            .appendField("var")
            .appendField(new Blockly.FieldTextInput("globalVar"), "VAR");
        this.appendValueInput("VALUE")
            .setCheck(null)
            .appendField("=");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour(330);
        this.setTooltip("Declare a global variable");
        this.setHelpUrl("");
      }
    };

    Blockly.JavaScript['global_var_variable'] = function(block) {
      var varName = block.getFieldValue('VAR');
      var value = Blockly.JavaScript.valueToCode(block, 'VALUE', Blockly.JavaScript.ORDER_ASSIGNMENT) || '0';
      return 'var ' + varName + ' = ' + value + ';\n';
    };

    Blockly.Blocks['game_display'] = {
      init: function() {
        this.appendDummyInput()
            .appendField("Display Object");
        this.appendValueInput("ID")
            .setCheck("String") 
            .appendField("ID");
        this.appendValueInput("VISIBLE")
            .setCheck("Boolean")
            .appendField("Visible");
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour(230);
        this.setTooltip("Show or hide a game object");
        this.setHelpUrl("");
      }
    };

    Blockly.JavaScript['game_display'] = function(block) {
      var id = Blockly.JavaScript.valueToCode(block, 'ID', Blockly.JavaScript.ORDER_ATOMIC) || '""';
      var visible = Blockly.JavaScript.valueToCode(block, 'VISIBLE', Blockly.JavaScript.ORDER_ATOMIC) || 'true';
      return `game.display(${id}, ${visible});\n`; 
    };

    const translations = {
      pt: {
        runButton: "Executar",
        copyButton: "Copiar Código",
        openModalButton: "Abrir Modal",
        modalTitle: "Estrutura do Jogo",
        runGameButton: "Executar Jogo",
        blocks: {
          logic: "Lógica",
          loops: "Loops",
          math: "Matemática",
          text: "Texto",
          lists: "Listas",
          color: "Cor",
          variables: "Variáveis",
          functions: "Funções"
        }
      },
      en: {
        runButton: "Run",
        copyButton: "Copy Code",
        openModalButton: "Open Modal",
        modalTitle: "Game Structure",
        runGameButton: "Run Game",
        blocks: {
          logic: "Logic",
          loops: "Loops",
          math: "Math",
          text: "Text",
          lists: "Lists",
          color: "Color",
          variables: "Variables",
          functions: "Functions",
          nandraki: "Nandraki",
          create_sprite: "Create Sprite",
          create_obj: "Create Object",
          create_ui: "Create UI",
          canvas_start: "Create Canvas",
          moveTouch: "Move object by touch/mouse input",
        },
        toolbox: {
          createSprite: "Create Sprite",
          createUI: "Create UI",
          moveObject: "Move Object",
          createObject: "Create Object",
          checkCollision: "Check Collision",
          defineFunction: "Define Function",
          setLayer: "Set Layer",
          setImageFrame: "Set Image Frame",
          spawnSprite: "Spawn Sprite",
          applyForce: "Apply Force",
          displayObject: "Display Object",
          createHTMLElement: "Create HTML Element"
        }
      },
      es: {
        runButton: "Ejecutar",
        copyButton: "Copiar Código",
        openModalButton: "Abrir Modal",
        modalTitle: "Estructura del Juego",
        runGameButton: "Ejecutar Juego",
        blocks: {
          logic: "Lógica",
          loops: "Bucles",
          math: "Matemáticas",
          text: "Texto",
          lists: "Listas",
          color: "Color",
          variables: "Variables",
          functions: "Funciones"
        }
      }
    };

    function updateBlockLabels(lang) {
      const categories = workspace.toolbox_.contents_;
      categories.forEach(category => {
        const name = category.name_;
        if (translations[lang].blocks[name.toLowerCase()]) {
          category.name_ = translations[lang].blocks[name.toLowerCase()];
          category.toolboxItemDef_.name = category.name_;
        }
      });
      workspace.toolbox_.refreshSelection();
    }

    function updateBlockTranslations(lang) {
      const blocks = workspace.getAllBlocks();
      blocks.forEach(block => {
        const type = block.type;
        if (translations[lang].toolbox[type]) {
          block.setTooltip(translations[lang].toolbox[type]);
        }
      });
    }

    function updateLanguage(lang) {
      document.getElementById('runButton').textContent = translations[lang].runButton;
      document.getElementById('copyButton').textContent = translations[lang].copyButton;
      document.getElementById('openModalButton').textContent = translations[lang].openModalButton;
      document.querySelector('.modal-content h2').textContent = translations[lang].modalTitle;
      document.getElementById('runGameButton').textContent = translations[lang].runGameButton;
      updateBlockLabels(lang);
      updateBlockTranslations(lang);
    }

    document.getElementById('languageSelect').addEventListener('change', function() {
      const newLang = this.value;
      updateLanguage(newLang);
      workspace.updateToolbox(document.getElementById('toolbox'));
    });

    document.addEventListener('DOMContentLoaded', function() {
      updateLanguage('pt');
    });

    var workspace = Blockly.inject('blocklyDiv', {
      toolbox: document.getElementById('toolbox'),
      scrollbars: true,
      trashcan: true,
      zoom: {
        controls: true,
        wheel: true,
        startScale: 1.0,
        maxScale: 3,
        minScale: 0.3,
        scaleSpeed: 1.2
      },
    });

    var outputDiv = document.getElementById('outputDiv');
    var codeEditor = CodeMirror(document.getElementById('codeDiv'), {
      mode: 'javascript',
      lineNumbers: true,
      theme: 'default'
    });

    function updateCode() {
      var code = Blockly.JavaScript.workspaceToCode(workspace);
      codeEditor.setValue(code);
    }

    workspace.addChangeListener(updateCode);

    document.getElementById('runButton').addEventListener('click', function() {
      var code = codeEditor.getValue();
      try {
        outputDiv.innerHTML = '';
        eval(code);
      } catch (e) {
        outputDiv.innerHTML = 'Erro: ' + e;
      }
    });

    document.getElementById('copyButton').addEventListener('click', function() {
      var code = codeEditor.getValue();
      navigator.clipboard.writeText(code).then(function() {
        alert('Código copiado para a área de transferência!');
      }, function(err) {
        console.error('Erro ao copiar código: ', err);
      });
    });

    const modal = document.getElementById("gameModal");
    const openModalButton = document.getElementById("openModalButton");
    const closeButton = document.getElementsByClassName("close")[0];
    const runGameButton = document.getElementById("runGameButton");
    let gameCodeEditor;

    document.addEventListener('DOMContentLoaded', function() {
      gameCodeEditor = CodeMirror(document.getElementById("gameCodeEditor"), {
        mode: "htmlmixed",
        theme: "default",
        lineNumbers: true,
        autoCloseTags: true,
        autoCloseBrackets: true,
        indentUnit: 2,
        tabSize: 2,
        lineWrapping: true,
        extraKeys: {"Ctrl-Space": "autocomplete"}
      });

      const cdnLink = document.getElementById("engineLinkInput").value;
      gameCodeEditor.setValue(`<html>
<head>
  <script src="${cdnLink}"><\/script>
</head>
<body>
  <script>
    Nandraki.create_ui("text_id","[hello world]")
    myjogo = {
      start : function(){
        // codigo do bloco aqui
      },	
    }

    fps=60;	
    game.update(myjogo.start,fps);  
  <\/script>
</body>
</html>`);
    });

    openModalButton.onclick = function() {
      modal.style.display = "block";
      gameCodeEditor.refresh();
    }

    closeButton.onclick = function() {
      modal.style.display = "none";
    }

    window.onclick = function(event) {
      if (event.target == modal) {
        modal.style.display = "none";
      }
    }

    runGameButton.onclick = function() {
      const gameWindow = window.open("", "Game Window", "width=800,height=600");
      gameWindow.document.write(gameCodeEditor.getValue());
      gameWindow.document.close();
    }

    document.getElementById("engineLinkInput").addEventListener("change", function() {
      const newCdnLink = this.value;
      const currentCode = gameCodeEditor.getValue();
      const updatedCode = currentCode.replace(/<script src=".*"><\/script>/, `<script src="${newCdnLink}"><\/script>`);
      gameCodeEditor.setValue(updatedCode);
    });
  </script>
</body>
</html>
